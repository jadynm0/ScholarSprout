<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Preferences — Study Planner</title>
  <link rel="stylesheet" href="newhacks.css">
  <style> .center{max-width:880px;margin:28px auto;padding:20px} </style>
</head>
<body>
  <div class="center">
    <h1>Persistent Preferences (save once)</h1>
    <div id="persistent-form" class="mb-4 p-4 bg-gray-50 rounded-lg">
      <h2 class="text-lg font-semibold mb-3">Tell us about your long-term preferences</h2>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-gray-700">Current Assignments</label>
          <textarea id="assignments" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="List your current assignments and their deadlines..."></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Best Study Time</label>
          <select id="study-time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
            <option value="morning">Morning</option>
            <option value="afternoon">Afternoon</option>
            <option value="evening">Evening</option>
            <option value="night">Night</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Study Preferences</label>
          <select id="study-preferences" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" size="5">
            <option value="quiet">Need Quiet Environment</option>
            <option value="music">Study with Music</option>
            <option value="group">Prefer Group Study</option>
            <option value="active">Active Learning/Practice</option>
            <option value="visual">Visual Learning</option>
          </select>
        </div>
        <!-- Extended one-time questions -->
        <div class="mt-4 p-3 border rounded-md">
          <h3 class="text-md font-semibold mb-2">A few quick questions</h3>
          <!-- Question 1 -->
          <fieldset style="margin-bottom:10px">
            <legend class="text-sm font-medium">If you looked at your calendar for today, what stands out most?</legend>
            <div><label><input type="radio" name="q_calendar" value="several"/> "There are several big tasks I need to complete."</label></div>
            <div><label><input type="radio" name="q_calendar" value="time_uncertain"/> "I have time but I'm not sure how much energy I'll have."</label></div>
            <div><label><input type="radio" name="q_calendar" value="no_deadlines"/> "No major deadlines, mostly regular work and review."</label></div>
            <div><label><input type="radio" name="q_calendar" value="ahead"/> "I'm ahead of schedule; I could push further if I want."</label></div>
          </fieldset>

          <!-- Question 2 -->
          <fieldset style="margin-bottom:10px">
            <legend class="text-sm font-medium">When you think about starting work today, what is your inner voice saying?</legend>
            <div><label><input type="radio" name="q_inner" value="hardest"/> "Let's get the hardest thing out of the way."</label></div>
            <div><label><input type="radio" name="q_inner" value="warmup"/> "I'll warm up with something easier and build up."</label></div>
            <div><label><input type="radio" name="q_inner" value="review_then_decide"/> "I'll review things I already know, then decide."</label></div>
            <div><label><input type="radio" name="q_inner" value="unsure"/> "I'm not sure; I might need to change approach mid-way."</label></div>
          </fieldset>

          <!-- Question 3 -->
          <fieldset style="margin-bottom:10px">
            <legend class="text-sm font-medium">In the past 10 minutes (or since you woke up), what best describes how you feel?</legend>
            <div><label><input type="radio" name="q_mood" value="alert"/> "Alert, ready to go."</label></div>
            <div><label><input type="radio" name="q_mood" value="okay_warmup"/> "Okay, but I might need a warm-up."</label></div>
            <div><label><input type="radio" name="q_mood" value="dragging"/> "Dragging a bit or easily distracted."</label></div>
            <div><label><input type="radio" name="q_mood" value="wandering"/> "My mind keeps wandering; I need short bursts."</label></div>
          </fieldset>

          <!-- Question 4 -->
          <fieldset style="margin-bottom:10px">
            <legend class="text-sm font-medium">If you were to estimate focus blocks today, which feels realistic?</legend>
            <div><label><input type="radio" name="q_focus" value="2hrs"/> 2 + hours solid work without break.</label></div>
            <div><label><input type="radio" name="q_focus" value="1_1.5"/> 1–1.5 hours before needing a pause.</label></div>
            <div><label><input type="radio" name="q_focus" value="30_45"/> 30–45 min before I lose concentration.</label></div>
            <div><label><input type="radio" name="q_focus" value="short_bursts"/> Many short bursts (25–30 min) with frequent resets.</label></div>
          </fieldset>

          <!-- Question 5 -->
          <fieldset style="margin-bottom:10px">
            <legend class="text-sm font-medium">What kind of task would you most like to start with?</legend>
            <div><label><input type="radio" name="q_task" value="challenging"/> A challenging, new concept or problem.</label></div>
            <div><label><input type="radio" name="q_task" value="review"/> A review or recap of something familiar.</label></div>
            <div><label><input type="radio" name="q_task" value="mix"/> A mix: small new part + review.</label></div>
            <div><label><input type="radio" name="q_task" value="organise"/> Organising/setting up: notes, outline, materials.</label></div>
          </fieldset>

          <!-- Question 6 -->
          <fieldset style="margin-bottom:6px">
            <legend class="text-sm font-medium">Considering the day ahead, how would you prioritise your tasks?</legend>
            <div><label><input type="radio" name="q_prioritise" value="urgent"/> Urgent & important tasks go first, then others.</label></div>
            <div><label><input type="radio" name="q_prioritise" value="interest"/> I'll pick by interest/energy rather than strict priority.</label></div>
            <div><label><input type="radio" name="q_prioritise" value="quick_wins"/> I'll aim for some quick wins then move to harder ones.</label></div>
            <div><label><input type="radio" name="q_prioritise" value="save_heavies"/> I'll set aside time for review/light work and save heavies for later.</label></div>
          </fieldset>
        </div>
        <div class="flex space-x-2 mt-2">
          <button id="save-preferences" class="flex-1 bg-green-600 text-white p-2 rounded-lg font-semibold">Save Preferences</button>
          <button id="edit-preferences" class="flex-1 bg-gray-200 p-2 rounded-lg">Edit</button>
        </div>
        <p id="persistent-status" class="text-xs text-green-600 hidden mt-1">Preferences saved locally.</p>
      </div>
    </div>

    <div style="margin-top:18px; display:flex; gap:8px;">
      <a id="to-session" class="btn btn-primary" href="session.html">Go to Session (use now)</a>
      <a id="to-chat" class="btn btn-soft" href="session.html#chat">Open Session with Chat</a>
    </div>
  </div>

  <script>
    const saveBtn = document.getElementById('save-preferences');
    const editBtn = document.getElementById('edit-preferences');
    const assignmentsInput = document.getElementById('assignments');
    const studyTimeSelect = document.getElementById('study-time');
    const studyPreferencesSelect = document.getElementById('study-preferences');
    const persistentStatus = document.getElementById('persistent-status');

    function loadPreferences() {
      try {
        const raw = localStorage.getItem('studyPreferences');
        if (!raw) return;
        const p = JSON.parse(raw);
        if (p.assignments) assignmentsInput.value = p.assignments;
        if (p.studyTime) studyTimeSelect.value = p.studyTime;
        if (Array.isArray(p.preferences)) {
          Array.from(studyPreferencesSelect.options).forEach(opt => { opt.selected = p.preferences.includes(opt.value); });
        }

        // Load saved survey answers if present
        const s = p.survey || {};
        if (s.calendar) {
          const el = document.querySelector(`input[name="q_calendar"][value="${s.calendar}"]`);
          if (el) el.checked = true;
        }
        if (s.inner) {
          const el = document.querySelector(`input[name="q_inner"][value="${s.inner}"]`);
          if (el) el.checked = true;
        }
        if (s.mood) {
          const el = document.querySelector(`input[name="q_mood"][value="${s.mood}"]`);
          if (el) el.checked = true;
        }
        if (s.focus) {
          const el = document.querySelector(`input[name="q_focus"][value="${s.focus}"]`);
          if (el) el.checked = true;
        }
        if (s.task) {
          const el = document.querySelector(`input[name="q_task"][value="${s.task}"]`);
          if (el) el.checked = true;
        }
        if (s.prioritise) {
          const el = document.querySelector(`input[name="q_prioritise"][value="${s.prioritise}"]`);
          if (el) el.checked = true;
        }

        persistentStatus.classList.remove('hidden');
      } catch(e){ console.warn('Failed to load preferences', e); }
    }

    function savePreferences(){
      const assignments = assignmentsInput.value.trim();
      if (!assignments) { alert('Please enter your assignments before saving preferences.'); return; }

      const survey = {
        calendar: document.querySelector('input[name="q_calendar"]:checked')?.value || '',
        inner: document.querySelector('input[name="q_inner"]:checked')?.value || '',
        mood: document.querySelector('input[name="q_mood"]:checked')?.value || '',
        focus: document.querySelector('input[name="q_focus"]:checked')?.value || '',
        task: document.querySelector('input[name="q_task"]:checked')?.value || '',
        prioritise: document.querySelector('input[name="q_prioritise"]:checked')?.value || ''
      };

      const payload = {
        assignments,
        studyTime: studyTimeSelect.value,
        preferences: Array.from(studyPreferencesSelect.selectedOptions).map(o=>o.value),
        survey
      };

      localStorage.setItem('studyPreferences', JSON.stringify(payload));
      persistentStatus.classList.remove('hidden');
      alert('Preferences saved. You can now go to the session page.');
    }

    saveBtn.addEventListener('click', (e)=>{ e.preventDefault(); savePreferences(); });
    editBtn.addEventListener('click', (e)=>{ e.preventDefault(); assignmentsInput.focus(); persistentStatus.classList.add('hidden'); });

    loadPreferences();
  </script>
</body>
</html>
